{"title":"操作系统·同步问题","slug":"操作系统·同步问题","date":"2021-04-06T04:01:51.000Z","updated":"2024-06-30T07:40:05.281Z","comments":false,"path":"api/articles/操作系统·同步问题.json","photos":[],"excerpt":"","covers":null,"content":"<p><strong>经典同步问题</strong></p>\n<p><em>1.生产者消费者问题</em></p>\n<ul>\n<li><p>一组生产者进程(Producer)</p>\n</li>\n<li><p>一组消费者进程(Consumer)</p>\n</li>\n<li><p>共享初始为空 大小为n的缓冲区(Buffer)</p>\n</li>\n</ul>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAINTEXT\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">semaphore mutex = 1;  //mutex</span><br><span class=\"line\">semaphore empty = n;  //buffer</span><br><span class=\"line\">semaphore full = 0;   //full</span><br><span class=\"line\"></span><br><span class=\"line\">Producer()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tProduce();</span><br><span class=\"line\">\t\tP(mutex);</span><br><span class=\"line\">\t\tadd2Buffer();</span><br><span class=\"line\">\t\tV(mutex);</span><br><span class=\"line\">\t\tV(full);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Consumer()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tP(full);</span><br><span class=\"line\">\t\tP(mutex);</span><br><span class=\"line\">\t\tgetFromBuffer();</span><br><span class=\"line\">\t\tV(mutex);</span><br><span class=\"line\">\t\tConsume();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><em>2.读者写者问题</em></p>\n<ul>\n<li>读者进程(Reader)</li>\n<li>写者进程(Writer)</li>\n<li>共享一个文档(Document)</li>\n<li>多进程读，不可多进程写</li>\n<li>写进程写，不可读</li>\n<li>写进程检查是否有读进程读</li>\n</ul>\n<p><strong>读进程优先</strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAINTEXT\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int count = 0;</span><br><span class=\"line\">semaphore mutex = 1;</span><br><span class=\"line\">semaphore rw = 1;</span><br><span class=\"line\">Reader()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tP(mutex);</span><br><span class=\"line\">\t\tif(count == 0)</span><br><span class=\"line\">\t\t\tP(rw);</span><br><span class=\"line\">\t\tcount++;</span><br><span class=\"line\">\t\tV(mutex);</span><br><span class=\"line\">\t\tRead();</span><br><span class=\"line\">\t\tP(mutex);</span><br><span class=\"line\">\t\tcount--;</span><br><span class=\"line\">\t\tif(count == 0)</span><br><span class=\"line\">\t\t\tV(rw);</span><br><span class=\"line\">\t\tV(mutex);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Writer()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tP(rw);</span><br><span class=\"line\">\t\twrite();</span><br><span class=\"line\">\t\tv(rw);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong>写进程优先</strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAINTEXT\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int count = 0;</span><br><span class=\"line\">semaphore mutex = 1;</span><br><span class=\"line\">semaphore rw = 1;</span><br><span class=\"line\">semaphore w = 1;</span><br><span class=\"line\">Writer()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tP(w);</span><br><span class=\"line\">\t\tP(rw);</span><br><span class=\"line\">\t\tWrite();</span><br><span class=\"line\">\t\tV(rw);</span><br><span class=\"line\">\t\tV(w);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Reader()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tP(w);</span><br><span class=\"line\">\t\tP(mutex);</span><br><span class=\"line\">\t\tif(count == 0)</span><br><span class=\"line\">\t\t\tP(rw);</span><br><span class=\"line\">\t\tcount++;</span><br><span class=\"line\">\t\tV(mutex);</span><br><span class=\"line\">\t\tV(w);</span><br><span class=\"line\">\t\tRead();</span><br><span class=\"line\">\t\tP(mutex);</span><br><span class=\"line\">\t\tcount--;</span><br><span class=\"line\">\t\tif(count == 0)</span><br><span class=\"line\">\t\t\tV(rw);</span><br><span class=\"line\">\t\tV(mutex);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><em>3.哲学家进餐问题</em></p>\n<ul>\n<li>5名哲学家(Philosopher)</li>\n<li>每两名之间有一根筷子(Chopstick)</li>\n<li>每名有一碗饭</li>\n<li>吃完饭思考</li>\n</ul>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAINTEXT\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">semaphore Chopsticks[5] = &#123;1, 1, 1, 1, 1&#125;;</span><br><span class=\"line\">semaphore mutex = 1;</span><br><span class=\"line\">Philosopher()&#123;</span><br><span class=\"line\">\tdo&#123;</span><br><span class=\"line\">\t\tP(mutex);</span><br><span class=\"line\">\t\tP(Chopsticks[i]);</span><br><span class=\"line\">\t\tP(Chopsticks[(i+1)%5]);</span><br><span class=\"line\">\t\tV(mutex);</span><br><span class=\"line\">\t\teat();</span><br><span class=\"line\">\t\tV(Chopsticks[i]);</span><br><span class=\"line\">\t\tV(Chopsticks[(i+1)%5]);</span><br><span class=\"line\">\t\tthink();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong>4.吸烟者问题</strong></p>\n<ul>\n<li>3个吸烟者进程(Smoker)</li>\n<li>1个提供者进程(Offer)</li>\n<li>Smoker1(paper, glue)</li>\n<li>Smoker2(tobacco, glue)</li>\n<li>Smoker3(paper, tobacco)</li>\n<li>Offer(offer1) return paper, glue</li>\n<li>Offer(offer2) return tobacco, glue</li>\n<li>Offer(offer3) return paper, tobacco</li>\n</ul>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAINTEXT\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int num = 0;\t//store random num</span><br><span class=\"line\">semaphore offer1 = 0;</span><br><span class=\"line\">semaphore offer2 = 0;</span><br><span class=\"line\">semaphore offer3 = 0;</span><br><span class=\"line\">semaphore end = 0;</span><br><span class=\"line\">Offer()&#123;</span><br><span class=\"line\">\twhlie(1)&#123;</span><br><span class=\"line\">\t\tnum++;</span><br><span class=\"line\">\t\tnum = num % 3;</span><br><span class=\"line\">\t\tif(num == 0)</span><br><span class=\"line\">\t\t\tV(offer1);</span><br><span class=\"line\">\t\telse if(num == 1)</span><br><span class=\"line\">\t\t\tV(offer2);</span><br><span class=\"line\">\t\telse</span><br><span class=\"line\">\t\t\tV(offer3);</span><br><span class=\"line\">\t\tP(end);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Smoker1()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tP(offer3);</span><br><span class=\"line\">\t\tsmoke();</span><br><span class=\"line\">\t\tV(end);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Smoker2()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tP(offer2);</span><br><span class=\"line\">\t\tsmoke();</span><br><span class=\"line\">\t\tV(end);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Smoker3()&#123;</span><br><span class=\"line\">\twhile(1)&#123;</span><br><span class=\"line\">\t\tP(offer1);</span><br><span class=\"line\">\t\tsmoke();</span><br><span class=\"line\">\t\tV(end);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><em>eg1</em></p>\n<ul>\n<li>3个进程P1 P2 P3</li>\n<li>互斥使用N个单元的缓冲区(Buffer)</li>\n<li>P1 produce() return (int num) put() @Buffer</li>\n<li>P2</li>\n</ul>\n","categories":[],"tags":[]}